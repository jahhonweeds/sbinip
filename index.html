<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vaccination Data Entry Form</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" type="text/css" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body>
  <div class="max-w-4xl mx-auto bg-base-100 shadow-lg rounded-xl p-6">
    <h2 class="text-4xl font-bold mb-4 text-center">SBI Report Form</h2>
    <form onsubmit="handleSubmit(event)" id="vaccineForm" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <div>
            <label class="block font-semibold mb-1">Date Conducted</label>
            <input type="date" name="dateconducted" class="w-42 input border border-gray-300 rounded-lg p-2" required>
          </div>
          <div>
            <label class="block mb-2 pt-2 font-medium">Select Municipality</label>
            <select id="municipality" name="municipality" class="w-full select">
              <option value="">-- Select Municipality --</option>
            </select>
          </div>
          <div>
            <label class="block font-semibold mb-1 pt-2">Name of School</label>
            <select id="schoolDropdown" name="schoolname" class="w-full select" required>
              <option value="">Loading schools...</option>
            </select>
          </div>
          <div class="mt-2 text-center invisible md:visible">
          <button type="submit" class="btn btn-lg btn-neutral">Submit</button>
        </div>
        </div>      
        <!-- name of each tab group should be unique -->
        <div class="tabs tabs-box md:col-span-3">
          <input type="radio" name="my_tabs_6" class="tab" aria-label="Grade 1" checked="checked"/>
          <div class="tab-content bg-base-100 border-base-300 p-6">
             <h3 class="font-bold text-lg  mb-2 text-center" >GRADE 1</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div><label class="block mb-1 font-medium">Total Enrolled</label><input type="number"
                  name="g1_total_enrolled" class="w-full border p-2 rounded" required></div>
              <div><label class="block mb-1 font-medium">Vaccinated w/ MR</label><input type="number"
                  name="g1_mr_vaccinated_no" class="w-full border p-2 rounded" required></div>
              <div><label class="block mb-1 font-medium">Vaccinated w/ TD</label><input type="number"
                  name="g1_td_vaccinated_no" class="w-full border p-2 rounded" required></div>
            </div>
            <h3 class="font-bold text-lg mt-6 mb-2">Deferred Cases</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div><label class="block mb-1 font-medium">MR Deferred (No.)</label><input type="number"
                  name="g1_mr_deferred" class="w-full border p-2 rounded"></div>
              <div><label class="block mb-1 font-medium">TD Deferred (No.)</label><input type="number"
                  name="g1_td_deferred" class="w-full border p-2 rounded"></div>
            </div>
            <h3 class="font-bold text-lg mt-6 mb-2">Refusal Cases</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div><label class="block mb-1 font-medium">MR Refusal (No.)</label><input type="number" name="g1_mr_refusal"
                  class="w-full border p-2 rounded"></div>
              <div><label class="block mb-1 font-medium">TD Refusal (No.)</label><input type="number" name="g1_td_refusal"
                  class="w-full border p-2 rounded"></div>
            </div>
          </div>
          <!-- Grade 4 -->
          <input type="radio" name="my_tabs_6" class="tab" aria-label="Grade 4"  />
          <div class="tab-content bg-base-100 border-base-300 p-6">
              <h3 class="font-bold text-lg  mb-2 text-center" >GRADE 4</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div><label class="block mb-1 font-medium">Total Enrolled</label><input type="number"
                    name="g4_total_enrolled" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">1st Dose of HPV</label><input type="number"
                    name="g4_1st_dose_hpv" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">2nd Dose of HPV</label><input type="number"
                    name="g4_2nd_dose_hpv" class="w-full border p-2 rounded" required></div>
              </div>
              <h3 class="font-bold text-lg mt-6 mb-2">Deferred Cases</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block mb-1 font-medium">1st Dose of HPV</label><input type="number"
                    name="g4_defered_hpv1st" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">2nd Dose of HPV</label><input type="number"
                    name="g4_defered_hpv2nd" class="w-full border p-2 rounded" required></div>
              </div>
              <h3 class="font-bold text-lg mt-6 mb-2">Refusal Cases</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
               <div><label class="block mb-1 font-medium">1st Dose of HPV</label><input type="number"
                    name="g4_refuse_hpv1st" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">2nd Dose of HPV</label><input type="number"
                    name="g4_refuse_hpv2nd" class="w-full border p-2 rounded" required></div>
              </div>
          </div>
          <!-- Grade 7 -->
          <input type="radio" name="my_tabs_6" class="tab" aria-label="Grade 7" />
         <div class="tab-content bg-base-100 border-base-300 p-6">
           <h3 class="font-bold text-lg  mb-2 text-center" >GRADE 7</h3>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div><label class="block mb-1 font-medium">Total Enrolled</label><input type="number"
                    name="g7_total_enrolled" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">Vaccinated w/ MR</label><input type="number"
                    name="g7_mr_vaccinated_no" class="w-full border p-2 rounded" required></div>
                <div><label class="block mb-1 font-medium">Vaccinated w/ TD</label><input type="number"
                    name="g7_td_vaccinated_no" class="w-full border p-2 rounded" required></div>
              </div>
              <h3 class="font-bold text-lg mt-3 mb-2">Deferred Cases</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block mb-1 font-medium">MR Deferred (No.)</label><input type="number"
                    name="g7_mr_deferred" class="w-full border p-2 rounded"></div>
                <div><label class="block mb-1 font-medium">TD Deferred (No.)</label><input type="number"
                    name="g7_td_deferred" class="w-full border p-2 rounded"></div>
              </div>
              <h3 class="font-bold text-lg mt-6 mb-2">Refusal Cases</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div><label class="block mb-1 font-medium">MR Refusal (No.)</label><input type="number"
                    name="g7_mr_refusal" class="w-full border p-2 rounded"></div>
                <div><label class="block mb-1 font-medium">TD Refusal (No.)</label><input type="number"
                    name="g7_td_refusal" class="w-full border p-2 rounded"></div>
              </div>
          </div>
        </div>
         <div class="mt-2 text-center visible md:invisible">
          <button type="submit" class="btn btn-block btn-neutral">Submit</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    async function handleSubmit(event) {
      event.preventDefault();
      const form = event.target;

      const formData = new URLSearchParams();
      formData.append("dateconducted", form.dateconducted.value);
      formData.append("municipality", form.municipality.value);
      formData.append("schoolname", form.schoolname.value);
      formData.append("g1_total_enrolled", form.g1_total_enrolled.value);
      formData.append("g1_mr_vaccinated_no", form.g1_mr_vaccinated_no.value);
      formData.append("g1_td_vaccinated_no", form.g1_td_vaccinated_no.value);
      formData.append("g1_mr_deferred", form.g1_mr_deferred.value);
      formData.append("g1_td_deferred", form.g1_td_deferred.value);
      formData.append("g1_mr_refusal", form.g1_mr_refusal.value);
      formData.append("g1_td_refusal", form.g1_td_refusal.value);
      formData.append("g4_total_enrolled", form.g4_total_enrolled.value);
      formData.append("g4_1st_dose_hpv", form.g4_1st_dose_hpv.value);
      formData.append("g4_2nd_dose_hpv", form.g4_2nd_dose_hpv.value);
      formData.append("g4_defered_hpv1st", form.g4_defered_hpv1st.value);
      formData.append("g4_defered_hpv2nd", form.g4_defered_hpv2nd.value);
      formData.append("g4_refuse_hpv1st", form.g4_refuse_hpv1st.value);
      formData.append("g4_refuse_hpv2nd", form.g4_refuse_hpv2nd.value);
      formData.append("g7_total_enrolled", form.g7_total_enrolled.value);
      formData.append("g7_mr_vaccinated_no", form.g7_mr_vaccinated_no.value);
      formData.append("g7_td_vaccinated_no", form.g7_td_vaccinated_no.value);
      formData.append("g7_mr_deferred", form.g7_mr_deferred.value);
      formData.append("g7_td_deferred", form.g7_td_deferred.value);
      formData.append("g7_mr_refusal", form.g7_mr_refusal.value);
      formData.append("g7_td_refusal", form.g7_td_refusal.value); 

      try {
        const response = await
          fetch("https://script.google.com/macros/s/AKfycbxbXgSXzw_VygmVgFry_XUckrMZKUJuvf4AVTyX57E2b2NJuGEQoK0ntJEM_8mjXDFx/exec", {
            method: "POST",
            body: formData,
          });
        const text = await response.text();
        alert("Submitted! Response: " + text);
        form.reset();
      } catch (err) {
        alert("Error: " + err.message);
      }
    }
  </script>

  <script>
    let schoolData = {};

    fetch('schools.json')
      .then(res => res.json())
      .then(data => {
        schoolData = data;

        // Populate Municipality Dropdown
        const municipalitySelect = document.getElementById('municipality');
        Object.keys(data).forEach(muni => {
          const option = document.createElement('option');
          option.value = muni;
          option.textContent = muni;
          municipalitySelect.appendChild(option);
        });

        // Event Listener: When Municipality Changes
        municipalitySelect.addEventListener('change', () => {
          const selectedMuni = municipalitySelect.value;
          const schoolSelect = document.getElementById('schoolDropdown');
          schoolSelect.innerHTML = '<option value="">-- Select School --</option>';

          if (data[selectedMuni]) {
            data[selectedMuni].forEach(school => {
              const option = document.createElement('option');
              option.value = school;
              option.textContent = school;
              schoolSelect.appendChild(option);
            });
          }
        });
      });
  </script>
</body>

</html>